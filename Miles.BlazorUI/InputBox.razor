@using System.Linq.Expressions
@if (LabelOnLeft)
{
    <div style="display:flex; flex-direction:row; flex-wrap:nowrap; overflow:hidden; @Style">
        <span style="display:flex; align-items:start;line-height: 1.2; white-space:nowrap; border: 1px solid gray; border-top-left-radius: 4px; border-bottom-left-radius: 4px; border-right: none; box-sizing:border-box; padding: @(Padding); width:fit-content; background-color: #f0f0f0; @LabelStyle">@RequiredFlag(Required)@Label</span>
        @if (MultiLine)
        {
            <textarea @bind="Value" @bind:after="OnValueChanged" required="@Required" disabled="@Disabled" readonly="@ReadOnly" rows="3" style="width:100%; min-height: 1.8em;  border: 1px solid gray; outline:none; border-radius: 4px; border-top-left-radius: 0px; border-bottom-left-radius: 0px; box-sizing:border-box; font-family:inherit; font-size:inherit; padding: @(Padding);"></textarea>
        }
        else
        {
            <input type="text" @bind="Value" @bind:after="OnValueChanged" required="@Required" disabled="@Disabled" readonly="@ReadOnly" style="width:100%; border: 1px solid gray; outline:none; border-radius: 4px; border-top-left-radius: 0px; border-bottom-left-radius: 0px; box-sizing:border-box; font-family:inherit; font-size:inherit; padding: @(Padding);" />
        }
    </div>
}
else
{
    <div style="display:flex; flex-direction:column; flex-wrap:nowrap; overflow:hidden; @Style">
        <span style="display:flex; align-items:center;line-height: 1.2; white-space:nowrap; border: 1px solid gray; border-bottom: none; border-top-left-radius: 4px; border-top-right-radius: 4px; box-sizing:border-box; padding: @(Padding); width:fit-content; background-color: #f0f0f0;  @LabelStyle">@RequiredFlag(Required)@Label</span>
        @if (MultiLine)
        {
            <textarea @bind="Value" @bind:after="OnValueChanged" required="@Required" disabled="@Disabled" readonly="@ReadOnly" style="border: 1px solid gray; outline:none; border-radius: 4px; border-top-left-radius: 0px; box-sizing:border-box; font-family:inherit; font-size:inherit; min-width:100%; padding: @(Padding);"></textarea>
        }
        else
        {
            <input type="text" @bind="Value" @bind:after="OnValueChanged" required="@Required" disabled="@Disabled" readonly="@ReadOnly" style="border: 1px solid gray; outline:none; border-radius: 4px; border-top-left-radius: 0px; box-sizing:border-box; font-family:inherit; font-size:inherit; padding: @(Padding);" />
        }
    </div>
}


@code {
    [Parameter, EditorRequired]
    public string Label { get; set; }

    [Parameter]
    public bool LabelOnLeft { get; set; }

    [Parameter]
    public string? LabelStyle { get; set; }

    [Parameter, EditorRequired]
    public string Value { get; set; }

    [Parameter]
    public string? Style { get; set; }

    [Parameter]
    public Expression<Func<string>>? ValueExpression { get; set; }

    [Parameter]
    public bool MultiLine { get; set; }

    [Parameter]
    public bool Required { get; set; }

    [Parameter]
    public bool Disabled { get; set; }

    [Parameter]
    public bool ReadOnly { get; set; }

    [Parameter]
    public EventCallback<string> ValueChanged { get; set; }

    [Parameter]
    public string Padding { get; set; } = "4px";

    private async Task OnValueChanged()
    {
        if (ValueChanged.HasDelegate)
            await ValueChanged.InvokeAsync(Value);
    }
    private RenderFragment<bool> RequiredFlag => required => __builder =>
    {
        if(required)
        {
            <span style="color:orange; mix-blend-mode: difference; user-select:none;">⚹</span>
        }
    };
}
